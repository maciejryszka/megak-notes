<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MegaKurs - JavaScript</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap&subset=latin-ext"
        rel="stylesheet" />
    <link rel="stylesheet" href="../styles/normalize.css" />
    <link rel="stylesheet" href="../styles/style.css" />
    <script src="https://kit.fontawesome.com/9e22ac749d.js" crossorigin="anonymous"></script>
</head>

<body>
    <header class="header">
        <nav class="header-navigation">
            <nav class="hamburger-menu hamburger-menu--js">
                <ul class="hamburger-menu__list">
                    <li class="hamburger-menu__list-item">
                        <a class="hamburger-menu__link" href="../index.html">strona główna</a>
                    </li>
                    <li class="hamburger-menu__list-item">
                        <a class="hamburger-menu__link" href="./javascript.html">1: JavaScript</a>
                    </li>
                    <li class="hamburger-menu__list-item">
                        <a class="hamburger-menu__link" href="./nodejs.html">2: Node.js</a>
                    </li>
                    <li class="hamburger-menu__list-item">
                        <a class="hamburger-menu__link" href="./expressjs.html">3: Express.js</a>
                    </li>
                    <li class="hamburger-menu__list-item">
                        <a class="hamburger-menu__link" href="#">4: bazy danych</a>
                    </li>
                    <li class="hamburger-menu__list-item">
                        <a class="hamburger-menu__link" href="#">5: TypeScript</a>
                    </li>
                    <li class="hamburger-menu__list-item">
                        <a class="hamburger-menu__link" href="#">6: Full-stack developer</a>
                    </li>
                    <li class="hamburger-menu__list-item">
                        <a class="hamburger-menu__link" href="#">7: Node.js advanced</a>
                    </li>
                </ul>
            </nav>
            <button class="header-navigation__button header-navigation__button--menu">
                <i class="fas fa-bars"></i>
            </button>
            <button class="header-navigation__button header-navigation__button--top">
                <i class="fas fa-arrow-circle-up"></i>
            </button>
            <p class="header-navigation__text">mega kurs javascriptu</p>
        </nav>
    </header>
    <main class="main theory-main">
        <h1 class="theory-main__heading">express.js</h1>
        <nav class="theory-main__links">
            <a href="#fundaments" class="theory-main__link">fundamenty express.js</a>
            <span class="theory-main__text">•</span>
            <a href="#request" class="theory-main__link">request</a>
            <span class="theory-main__text">•</span>
            <a href="#response" class="theory-main__link">response</a>
            <span class="theory-main__text">•</span>
            <a href="#routing" class="theory-main__link">routing</a>
            <span class="theory-main__text">•</span>
        </nav>
        <div class="theory-main__image"></div>
        <article id="fundaments" class="article">
            <h2 class="article__heading">fundamenty express.js</h2>
            <p class="article__text">Express.js jest frameworkiem serwera webowego dla Node.js.</p>
            <p class="article__text">Cechy Express.js:</p>
            <ul class="article__list">
                <li class="article__list-item">Jest szybki - prawie tak szybki jak sam <i>HTTP server</i> Node.js.</li>
                <li class="article__list-item">Jest minimalistyczny - zawiera tylko najważniejsze rzeczy, lecz może być
                    rozszerzany o dodatkowe moduły.</li>
                <li class="article__list-item">Nie wymusza określonego podejścia podczas pisania kodu.</li>
            </ul>
            <p class="article__text">Zalety Express.js:</p>
            <ul class="article__list">
                <li class="article__list-item">Pozwala na wykonanie w sposób szybszy wielu rzeczy dostępnych w Node.js
                    (dzięki dostarczasniu narzędzi pomagających pisać aplikacje webowe i mobilne od strony back-endu).
                </li>
                <li class="article__list-item">Ułatwia pisanie ścieżek, obsługę poszczególnych metod <i>HTTP</i> oraz
                    tworzenie <i>API</i>.</li>
                <li class="article__list-item">Korzysta z rzeczy zawartych w Node.js. Dodane są jedynie pewne
                    możliwości, które przekładają się na szybsze działanie Express.js.</li>
                <li class="article__list-item">Jest wykorzystywany jako podstawa innych, bardziej zaawansowanych
                    frameworków webowych opartych na Node.js (np. <i>NestJS</i>, <i>Sails.js</i>, <i>LoopBack</i>).
                    Frameworki takie stosowane są głównie do tworzenia rozbudowanych aplikacji.
                </li>
            </ul>
            <p class="article__text">Sposób użycia Express.js:</p>
            <ul class="article__list">
                <li class="article__list-item"><strong>npm i express</strong> - instalacja za pośrednictwem dowolnego
                    menadżera paczek (przykładowa komenda dla menadżera <i>npm</i>).</li>
                <li class="article__list-item"><strong>require('express')</strong> - import modułu z wykorzystaniem
                    metody <i>require</i> (należy pobrać cały moduł do jednej zmiennej bez stosowania destrukturyzacji).
                </li>
                <li class="article__list-item"><strong>const app = express()</strong> - importowany moduł <i>express</i>
                    jest jedną, wielką funkcją, której wywołanie tworzy aplikację back-endową.
                </li>
                <li class="article__list-item"><strong>app.listen(portNumber)</strong> - uruchomienie nasłuchiwania
                    poprzez wywołanie funkcji <i>listen</i> na obiekcie aplikacji. Argumentem jest łańcuch znaków
                    zawierający numer portu, na którym wykonywane będzie nasłuchiwanie.
                </li>
                <li class="article__list-item"><strong>app.httpMethod(path, () => {})</strong> - wywołanie funkcji
                    <i>callback</i> następuje w przypadku otrzymania określonego żądania dla określonej ścieżki.
                </li>
                <li class="article__list-item"><strong>app.all(path, () => {})</strong> - wywołanie funkcji
                    <i>callback</i> następuje w przypadku otrzymania jakiegokolwiek żądania dla określonej ścieżki.
                </li>
            </ul>
            <p class="article__text">Zasób jest jednak najczęściej definiowany na podstawie dwóch informacji: metody i
                ścieżki (metoda <i>all</i> nie jest wykorzystywana zbyt często).
            </p>
        </article>
        <article id="request" class="article">
            <h2 class="article__heading">request</h2>
            <p class="article__text">Obiekt typu <strong>Request</strong> występujący jako pierwszy parametr w funkcji
                <i>callback</i> (wywoływanej w przypadku otrzymania żądania) reprezentuje każde żądanie <i>HTTP</i>.
                Najczęściej przyjęło się nazywać ten parametr <i>req</i>. Obiekt typu <i>Request</i> pochodzący z
                Express.js różni się od swojego odpowiednika pochodzącego z Node.js.
            </p>
            <p class="article__text">Własności i metoda obiektu typu <i>Request</i>:</p>
            <ul class="article__list">
                <li class="article__list-item"><strong>hostname</strong> - nazwa hosta - serwera, na którym uruchomiona
                    jest aplikacja.</li>
                <li class="article__list-item"><strong>ip</strong> - adres <i>IP</i> klienta - najczęściej więc
                    komputera lub urządzenia mobilnego, z którego przeglądarki wysłano zapytanie do serwera. Czasami
                    serwer <i>proxy</i> ukrywa i nadpisuje informację o <i>IP</i>.</li>
                <li class="article__list-item"><strong>ips</strong> - tablica adresów <i>IP</i>, z których przeglądarki
                    wysłano zapytania do serwera. Przydatna własność ze względu na to, że w wielu przypadkach <i>IP</i>
                    jest zakłamane przez <i>proxy</i>. Aby odzyskać oryginalne <i>IP</i>, należy szukać go w tablicy z
                    adresami.</li>
                <li class="article__list-item"><strong>method</strong> - metoda, za pomocą której klient próbuje
                    połączyć się z serwerem.</li>
                <li class="article__list-item"><strong>url</strong> - ścieżka. Nie pochodzi z Express.js, lecz z Node.js
                </li>
                <li class="article__list-item"><strong>originalUrl</strong> - ścieżka, która jest pierwotna i
                    znormalizowana, nawet po przekierowaniach (zalecany sposób).</li>
                <li class="article__list-item"><strong>path</strong> - ścieżka, która zawiera również parametry (jeśli
                    zostały przekazane).</li>
                <li class="article__list-item"><strong>protocol</strong> - protokół użyty do przesłania żądania.</li>
                <li class="article__list-item"><strong>secure</strong> - wartość logiczna sprawdzająca czy użyto
                    bezpiecznego protokołu do przesłania żądania.</li>
                <li class="article__list-item"><strong>get</strong>() - jako argument przyjmuje łańcuch znaków
                    zawierający nazwę nagłówka żądania. Zwraca wartość konkretnego nagłówka.</li>
            </ul>
            <p class="article__text">Parametry mogą być przekazywane z użyciem adresu <i>URL</i> za pomocą tzw. <i>Query
                    String</i> (np. <i>http://www.phoneshop.com/?product=phone&size=32gb&color=white</i>):</p>
            <ul class="article__list">
                <li class="article__list-item"><strong>?</strong> - początek <i>Query String</i> (żądanie zostanie
                    przekierowane do ścieżki znajdującej się przed tym znakiem, niezależnie od tego co znajduje się po
                    nim).</li>
                <li class="article__list-item"><strong>&</strong> - separator <i>Query String</i>.</li>
                <li class="article__list-item"><strong>product</strong>, <strong>size</strong>, <strong>color</strong> -
                    nazwy parametrów.</li>
                <li class="article__list-item"><strong>phone</strong>, <strong>32gb</strong>, <strong>white</strong> -
                    wartości parametrów.</li>
            </ul>
            <p class="article__text">Sposoby generowania parametrów adresu <i>URL</i> na front-endzie (np. w celu:
                przekierowania do konkretnego użytkownika, paginacji (przypisania kolejnych liczb do kolejnych stron),
                zastosowania dynamicznych adresów wyszukiwania, zastosowania dynamicznych adresów filtrowania,
                zastosowania dynamicznych adresów sortowania):
            </p>
            <ul class="article__list">
                <li class="article__list-item">Z użyciem <strong>encodeURIComponent</strong> (sposób ręczny) - przyjmuje
                    wartość parametru będącą dowolnym łańcuchem znaków i zwraca łańcuch znaków poprawny do przesłania za
                    pomocą <i>URL</i> (niezalecana metoda).
                </li>
                <li class="article__list-item">Z użyciem obiektu na bazie <strong>URLSearchParams</strong> - klasę
                    należy importować z modułu <i>url</i> z Node.js.</li>
            </ul>
            <p class="article__text">Spacja w nazwie lub wartości parametru przekazywana jest do adresu <i>URL</i> jako
                <strong>+</strong> lub <strong>%20</strong>. Ze względu na problem z odczytem znaku <strong>+</strong> w
                Express.js, wszystkie takie znaki należy zamienić na <strong>%20</strong> z użyciem funkcji
                <i>replace(/\+/g, '%20')</i> na łańcuchu znaków reprezentującym <i>URL</i>.
            </p>
            <p class="article__text">Odbiór parametrów przekazanych z użyciem adresu <i>URL</i> (z wykorzystaniem
                <i>Query String</i>), po stronie Express.js odbywa się z użyciem obiektu <strong>req.query</strong>,
                gdzie klucze obiektu to nazwy parametrów, a wartości obiektu to wartości parametrów. W przypadku braku
                przekazania parametrów wraz z adresem <i>URL</i>, obiekt ten będzie pusty.
            </p>
        </article>
        <article id="response" class="article">
            <h2 class="article__heading">response</h2>
            <p class="article__text">Obiekt typu <strong>Response</strong> występujący jako drugi parametr w funkcji
                <i>callback</i> (wywoływanej w przypadku otrzymania żądania) reprezentuje każdą odpowiedź serwera na
                żądanie HTTP. Najczęściej przyjęło się nazywać ten parametr <i>res</i>. Obiekt typu <i>Response</i>
                pochodzący z Express.js różni się od swojego odpowiednika pochodzącego z Node.js.
            </p>
            <p class="article__text">Metody <i>write</i> oraz <i>end</i> wywoływane na obiekcie typu <i>Response</i> w
                Node.js, mogą być również użyte w Express.js. Metody te nie są jednak częścią Express.js, lecz są
                przekierowane bezpośrednio do serwera Node.js, który działa na niższym poziomie niż Express.js. Zamiast
                dwóch powyższych metod warto korzystać z szybszej metody <strong>res.send()</strong>, będącej metodą
                Express.js. Jest ona wygodniejsza do użycia, ponieważ wykonuje też szereg innych działań w tle.
            </p>
            <p class="article__text">Działania wykonywane przez metodę <i>send</i> wywołaną na obiekcie typu
                <i>Response</i> w Express.js:
            </p>
            <ol class="article__list">
                <li class="article__list-item">Automatyczne ustawienie nagłówka <i>Content-Type</i> w zależności od
                    wysłanej zawartości.</li>
                <li class="article__list-item">Automatyczne ustawienie nagłówka <i>Content-Length</i>.</li>
                <li class="article__list-item">Ustawienie nagłówków związanych z podstawowym <i>cachingiem</i>.</li>
                <li class="article__list-item">Konwersja danych (jeśli jest wymagana).</li>
                <li class="article__list-item">Przesłanie danych.</li>
                <li class="article__list-item">Zakończenie połączenia.</li>
            </ol>
            <p class="article__text">Dane możliwe do przesłania przez metodę <i>send</i> wywołaną na obiekcie typu
                <i>Response</i> w Express.js:
            </p>
            <ul class="article__list">
                <li class="article__list-item"><strong>string</strong> - przesyłany jest tekst, a nagłówek
                    <i>Content-Type</i> przyjmuje wartość <i>text/hmtl</i>,
                </li>
                <li class="article__list-item"><strong>Buffer</strong> - przesyłane są dane binarne, a nagłówek
                    <i>Content-Type</i> przyjmuje wartość <i>application-octet-stream</i>,
                </li>
                <li class="article__list-item"><strong>array/Object</strong> - przesyłana jest tablica lub obiekt, a
                    nagłówek <i>Content-Type</i> przyjmuje wartość <i>application/json</i>.</li>
            </ul>
            <p class="article__text">Metoda <strong>res.json()</strong> działa podobnie jak metoda <i>send</i>, lecz
                zawsze wysyła obiekt typu <i>JSON</i> oraz ustawia nagłówek <i>Content-Type</i> na
                <i>application/json</i>. Metoda ta jest metodą pomocniczą - powstała za względu na fakt, że zdecydowana
                większość <i>API</i> otrzymuje i przesyła obiekty typu <i>JSON</i>. Kiedy jako odpowiedź oczekiwany jest
                obiekt typu <i>JSON</i>, zawsze powinno się używać metody <i>json</i>, ponieważ niezależnie od danych
                wejściowych (nawet gdy jest to łańcuch znaków), wysłany zostanie obiekt typu <i>JSON</i>. Ponadto w
                Express.js dostępne są specjalne opcje dla metody <i>json</i>, pozwalające m.in. na lepsze formatowanie
                wysyłanego obiektu.
            </p>
            <p class="article__text">Metoda <strong>res.location()</strong> jako argument przyjmuje docelowy adres
                <i>URL</i> i przekierowuje klienta na inny adres (w wewnętrznym lub zewnętrznym systemie). Aby wykonać
                prawidłowe przekierowanie z użyciem metody <i>location</i>, należy na obiekcie typu <i>Response</i>
                ustawić odpowiedni status przekierowania z wykorzystaniem własności <i>statusCode</i> a także zakończyć
                wysyłanie odpowiedzi z wykorzystaniem metody <i>end</i>.
            </p>
            <p class="article__text">Metoda zalecana do tworzenia przekierowań to <strong>res.redirect()</strong>.
                Jako argument przyjmuje docelowy adres <i>URL</i>. Tworzy ona całkowite przekierowanie: automatycznie
                ustawia kod statusu odpowiedzi <i>HTTP</i> (domyślnie 302 - można go zmienić dodając numer kodu
                odpowiedzi jako dodatkowy, pierwszy argument), automatycznie zakańcza wysyłanie odpowiedzi, a także
                pozwala na używanie specjalnych ścieżek (względnych i cofających).</p>
            <p class="article__text">Najczęściej używane kody statusów <i>HTTP</i> do przekierowania:</p>
            <ul class="article__list">
                <li class="article__list-item"><strong>301 - przekierowanie trwałe</strong> - przeglądarka (lub
                    wyszukiwarka) zapamiętuje nowy adres i nie odpytuje już więcej przekierowującego adresu.</li>
                <li class="article__list-item"><strong>302 - przekierowanie nietrwałe</strong> - w momencie żądania
                    przeglądarka przechodzi na podany adres, ale niekoniecznie musi zachować się podobnie w przyszłości.
                </li>
                <li class="article__list-item"><strong>303 - zobacz gdzie indziej</strong> - działanie podobne jak dla
                    kodu 302, ale używane przy innej metodzie <i>HTTP</i> niż <i>GET</i>, mające za zadanie przekierować
                    na metodę <i>GET</i>.</li>
                <li class="article__list-item"><strong>307 - przekierowanie tymczasowe</strong> - działanie podobne jak
                    dla kodu 302, ale używane przy innej metodzie <i>HTTP</i> niż <i>GET</i>.</li>
            </ul>
            <p class="article__text">Rodzaje ścieżek dla funkcji <i>location</i>:</p>
            <ol class="article__list">
                <li class="article__list-item">Absolutne adresy <i>URL</i>.</li>
                <li class="article__list-item">Wewnętrzne ścieżki.</li>
                <li class="article__list-item">Ścieżki względne z użyciem (z użyciem <strong>..</strong>).</li>
                <li class="article__list-item">"back" - odniesienie do nagłówka <i>Referer</i> lub jeśli taki nagłówek
                    nie istnieje - do ścieżki głównej.</li>
            </ol>
        </article>
        <article id="routing" class="article">
            <h2 class="article__heading">routing</h2>
            <p class="article__text"><strong>Routing</strong> mówi o tym, co należy wykonać w jakim zasobie (zasób -
                konkretna metoda oraz ścieżka).</p>
            <p class="article__text">Parametry (zmienne części) ścieżek pozwalają na przesyłanie dowolnych danych w
                konkretnym miejscu, dzięki czemu nie jest konieczne tworzenie <i>routingu</i> dla każdego zasobu z
                osobna. Poszczególne elementy ścieżki oddzielone są od siebie za pomocą: <strong>/</strong>
                (najczęściej), <strong>.</strong> lub <strong>-</strong>. Nazwy parametrów poprzedzone są znakiem
                <strong>:</strong>, a reguły dotyczące ich nazywania są takie same jak reguły dotyczące nazywania
                zmiennych.
            </p>
            <p class="article__text">Przykłady:</p>
            <ul class="article__list">
                <li class="article__list-item"><strong>/const1/const2/:variable</strong>,</li>
                <li class="article__list-item"><strong>/const1/const2/:variable1/const3/:variable2</strong>.</li>
            </ul>
            <p class="article__text">Należy uważać na podobne ścieżki korzystające z tej samej metody, w której tylko
                jedna z nich korzysta ze zmiennych. W takim wypadku, tworząc <i>routing</i>, ścieżki korzystające
                wyłącznie ze stałych należy umieszczać przed ścieżkami wykorzystującymi zmienne. Kod jest interpretowany
                od góry do dołu i jeśli w pierwszej kolejności zostanie napisany kod obsługujący ścieżkę wykorzysującą
                zmienną - stała w adresie <i>URL</i> zostanie potraktowana jako ta zmienna.</p>
            <p class="article__text">Przykłady (oba wykorzystujące tę samą metodę <i>HTTP</i>):</p>
            <ul class="article__list">
                <li class="article__list-item"><strong>/hello/new-user</strong> (ten <i>URL</i> powinien zostać
                    obsłużony w kodzie jako pierwszy),</li>
                <li class="article__list-item"><strong>/hello/:name</strong> (ten <i>URL</i> powinien zostać obsłużony w
                    kodzie jako drugi).</li>
            </ul>
            <p class="article__text">Parametry opcjonalne to parametry, które nie są wymagane. Czesto jednak dodawane są
                ze względu na <i>SEO (search engine optimization)</i>, ponieważ w systemie najczęściej istotne jest
                <i>ID</i>, a nie tytuł czy nazwa. Nazwy parametrów opcjonalnych poprzedzone są znakiem
                <strong>:</strong> a zakończone znakiem <strong>?</strong>.
            </p>
            <p class="article__text">Dzięki parametrom opcjonalnym ścieżka <strong>/article/:id/:title?</strong> pasuje
                do obu poniższych adresów:</p>
            <ul class="article__list">
                <li class="article__list-item"><strong>.../article/123</strong>,</li>
                <li class="article__list-item"><strong>.../article/123/article-title</strong>.</li>
            </ul>
            <p class="article__text">Wszystkie przesłane parametry są dostępne w obiekcie <strong>req.params</strong>
                pod takimi nazwami jakie zostały ustalone (lecz bez znaku <strong>:</strong>).</p>
        </article>
    </main>
    <footer class="footer">
        <p class="footer__text">Maciej Ryszka - 2022</p>
    </footer>
    <script src="../scripts/hamburger-menu.js"></script>
    <script src="../scripts/top-button.js"></script>
</body>

</html>